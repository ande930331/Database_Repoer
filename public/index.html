<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>äºŒæ‰‹é‡æ©Ÿäº¤æ˜“ç¶²</title>
    <style>
        body { font-family: "Segoe UI", sans-serif; margin: 0; background: #f4f4f4; }
        nav { background: #333; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        .filter-bar { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .filter-bar select, .filter-bar input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .filter-bar button { padding: 8px 15px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .moto-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s; display: flex; flex-direction: column;}
        .card:hover { transform: translateY(-5px); }
        .card-img { width: 100%; height: 180px; object-fit: cover; background: #eee; }
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .sold-badge { background: red; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
        a { color: white; text-decoration: none; margin-left: 15px; }
        .price { color: #d00; font-size: 1.4em; font-weight: bold; margin: 5px 0; }
        .desc { font-size: 0.9em; color: #555; margin-top: 10px; flex: 1; line-height: 1.4; }
        .info-tag { font-size: 0.85em; color: #666; background: #eee; padding: 3px 8px; border-radius: 10px; margin-right: 5px; display: inline-block; margin-bottom: 5px; }
        .btn-register { border: 1px solid white; padding: 5px 10px; border-radius: 4px; }
        .btn-register:hover { background: white; color: #333; }
        .btn-reserve { width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; font-size: 1rem; transition: background 0.2s; }
        .btn-reserve:hover { background: #0056b3; }
        .btn-sold-out { width: 100%; padding: 10px; background: #ccc; color: white; border: none; border-radius: 4px; margin-top: 15px; cursor: not-allowed; }
    </style>
</head>
<body>
    <nav>
        <div style="font-size: 1.5em; font-weight:bold;">ğŸï¸ MotoMarket</div>
        <div id="authLinks"><a href="login.html">ç™»å…¥</a><a href="register.html" class="btn-register">å…è²»è¨»å†Š</a></div>
    </nav>
    <div class="container">
        <h2>ğŸ”¥ æœ€æ–°ä¸Šæ¶è»Šè¼›</h2>
        <div class="filter-bar">
            <select id="filter_license"><option value="">æ‰€æœ‰ç‰Œç…§</option><option value="1">ç´…ç‰Œ (550ccâ†‘)</option><option value="2">é»ƒç‰Œ (250-550cc)</option><option value="3">ç™½ç‰Œ (250ccâ†“)</option></select>
            <select id="filter_category"><option value="">æ‰€æœ‰è»Šå‹</option><option value="1">ä»¿è³½</option><option value="2">è¡—è·‘</option><option value="3">è¡—è»Š</option><option value="4">é€Ÿå¯é”</option><option value="5">å†’éšª</option></select>
            <input type="number" id="filter_year" placeholder="å¹´ä»½" style="width: 120px;">
            <select id="sort_order"><option value="newest">æœ€æ–°ä¸Šæ¶</option><option value="price_asc">åƒ¹æ ¼ï¼šä½ â†’ é«˜</option><option value="price_desc">åƒ¹æ ¼ï¼šé«˜ â†’ ä½</option><option value="year_desc">å¹´ä»½ï¼šæ–° â†’ èˆŠ</option><option value="year_asc">å¹´ä»½ï¼šèˆŠ â†’ æ–°</option></select>
            <button onclick="fetchCars()">ğŸ” æœå°‹</button><button onclick="resetFilters()" style="background:#999;">é‡ç½®</button>
        </div>
        <div id="motoList" class="moto-grid">è¼‰å…¥ä¸­...</div>
    </div>
    <script>
        let currentUser = null;
        fetch('/api/me').then(res=>res.json()).then(data => {
            if(data.loggedIn) {
                currentUser = data.user;
                let html = `<span>Hi, ${data.user.name}</span>`;
                if(data.user.role === 'admin') html += `<a href="admin.html" style="color:#ffc107; margin-left:10px; font-weight:bold;">[é€²å…¥å¾Œå°]</a>`;
                else html += `<a href="profile.html" style="background:#17a2b8; padding:5px 10px; border-radius:4px; margin-left:10px; font-size:0.9em;">ğŸ‘¤ æœƒå“¡ä¸­å¿ƒ</a>`;
                html += `<a href="#" onclick="logout()" style="color:white; margin-left:10px;">ç™»å‡º</a>`;
                document.getElementById('authLinks').innerHTML = html;
            }
            fetchCars();
        });
        function logout() { fetch('/api/logout', {method:'POST'}).then(()=>window.location.reload()); }
        function fetchCars() {
            const license = document.getElementById('filter_license').value;
            const category = document.getElementById('filter_category').value;
            const year = document.getElementById('filter_year').value;
            const sort = document.getElementById('sort_order').value;
            const params = new URLSearchParams({ license_id: license, category_id: category, year: year, sort: sort });
            fetch(`/api/motorcycles?${params.toString()}`).then(res => res.json()).then(cars => {
                const list = document.getElementById('motoList');
                if(cars.length === 0) { list.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">ç„¡ç¬¦åˆè»Šè¼›ã€‚</p>'; return; }
                list.innerHTML = cars.map(car => {
                    const imgSrc = car.image_url || 'https://via.placeholder.com/300x200?text=No+Image';
                    const desc = car.description || 'æš«ç„¡æè¿°';
                    const mileageText = car.mileage ? `${car.mileage.toLocaleString()} km` : '---';
                    let actionBtn = '';
                    if (currentUser && currentUser.role === 'admin') actionBtn = `<button style="width:100%; padding:10px; background:#ffc107; color:black; border:none; border-radius:4px; margin-top:15px; cursor:pointer;" onclick="window.location.href='admin.html'">âš™ï¸ ç®¡ç†è»Šè¼›</button>`;
                    else if (car.status === 'available') actionBtn = `<button class="btn-reserve" onclick="window.location.href='reservation.html?id=${car.moto_id}'">ğŸ“… é ç´„è³è»Š</button>`;
                    else actionBtn = `<button class="btn-sold-out" disabled>ğŸš« å·²å”®å‡º</button>`;
                    return `<div class="card"><img src="${imgSrc}" class="card-img"><div class="card-body"><h3>${car.brand} ${car.model}</h3><p class="price">$${car.price.toLocaleString()}</p><div><span class="info-tag">${car.year || '--'}å¹´</span><span class="info-tag">${car.license_name}</span><span class="info-tag">${mileageText}</span></div><div class="desc">${desc}</div>${actionBtn}</div></div>`;
                }).join('');
            });
        }
        function resetFilters() { document.getElementById('filter_license').value = ""; document.getElementById('filter_category').value = ""; document.getElementById('filter_year').value = ""; document.getElementById('sort_order').value = "newest"; fetchCars(); }
    </script>
</body>
</html>